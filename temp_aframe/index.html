<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>webxr</title>
  <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
  <script>
    AFRAME.registerComponent('phoenix-flight', {
      init: function () {
        this.isFlying = false;

        const scene = document.querySelector('a-scene');
        scene.addEventListener('click', this.triggerFlight.bind(this));
      },

      triggerFlight: function () {
        if (this.isFlying) return;

        this.isFlying = true;
        const currentPos = this.el.getAttribute('position');

        const startPos = `-10 ${currentPos.y} ${currentPos.z}`;
        const endPos = `10 ${currentPos.y} ${currentPos.z}`;
        const flyDur = 4000;

        this.el.setAttribute('position', startPos);

        this.el.setAttribute('animation__fly', {
          property: 'position',
          to: endPos,
          dur: flyDur,
          easing: 'easeInOutQuad'
        });

        setTimeout(() => {
          this.el.setAttribute('position', this.currentPos);
          this.el.removeAttribute('animation__fly');
          this.isFlying = false;
        }, flyDur);
      }
    });
  </script>
</head>

<body>
  <h1>A-Frame</h1>
  <a-scene>
    <a-entity light="type:directional; castShadow:true;" position="1 1 1"></a-entity>
    <a-assets>
      <img id="birdo" src="public/birdo.png" />
      <img id="sky" src="public/sky.png">
      <a-asset-item id="me" src="public/me.glb"></a-asset-item>
      <a-asset-item id="phoenix" src="public/phoenix.glb"></a-asset-item>
    </a-assets>

    <a-entity gltf-model="#me" position="0 0 -3"
      animation="property: rotation; to: 0 360 0; loop: true; dur: 10000; easing: linear"></a-entity>

    <a-entity gltf-model="#phoenix" position="-10 3 -6" scale="0.01 0.01 0.01" animation-mixer
      phoenix-flight></a-entity>

    <a-box position="-1 0.5 -3" rotation="0 0 0" material="src: #birdo"
      animation="property: rotation; to: 0 360 0; loop: true; dur: 1000; easing: linear"
      animation__2="property: scale; to: 1.5 1.5 1.5; dur: 1000; easing: easeInOutQuad; loop: true; dir: alternate"></a-box>
    <a-sphere position="1 4 -3" radius="2" material="shader: flat; color: yellow; opacity: 0.5;"></a-sphere>
    <a-cylinder position="1 1.75 -3" radius="0.5" height="1" color="pink"></a-cylinder>
    <a-plane position="0 0 -4" rotation="-90 0 0" width="4" height="4" color="grey"></a-plane>
    <a-sky src="#sky"></a-sky>
    <a-text value="A-Frame!" position="0 3 -2" color="#000000"></a-text>
  </a-scene>
</body>

</html>